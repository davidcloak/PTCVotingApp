@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    var data = ViewBag.poles;
}

<style>
    .conCenter {
        position: fixed;
        z-index: 999;
    }

    div.conCenter {
        background-color: antiquewhite;
        margin: 5px;
        padding: 5px;
        width: 65%;
        height: 75%;
        overflow: auto;
        text-align: justify;
        border: 0.15em solid black;
    }
</style>
<script>
    let place = '';

    function picker(where) {
        var conferm = document.getElementById("confermation");
        conferm.style.visibility = 'visible';
        place = where;
    }

    function RemoveCon(name, party, description) {
        var conferm = document.getElementById("confermation");
        conferm.style.visibility = 'hidden';
        document.getElementById(place + "NameB").innerHTML = name;
        document.getElementById(place + "Name").value = name;
        document.getElementById(place + "PartyB").innerHTML = party;
        document.getElementById(place + "Party").value = party;
        document.getElementById(place + "DesB").innerHTML = description;
        document.getElementById(place + "Des").value = description;
    }

    function remove(where) {
        //check to make sure before deploying just testing to see if it works for now
        document.getElementById(where).remove();
    }

    let count = -1;
    function AddRunner() {
        count -= 1;
        var con = document.getElementById("poli");

        var container = document.createElement("div");
        container.setAttribute("style", "border: 0.15em solid black; padding: 1em; margin-top: 1em;");
        container.setAttribute("id", count + "Div");

        var row1 = document.createElement("div");
        row1.setAttribute("class", "row");
        row1.setAttribute("style", "margin-bottom: 1em;");

        var col1 = document.createElement("div");
        col1.setAttribute("class", "col-6");

        var label1 = document.createElement("label");
        label1.innerHTML = "Name:";

        var input1 = document.createElement("input");
        input1.setAttribute("id", count + "Name");
        input1.setAttribute("name", "name[]");
        input1.setAttribute("style", "width: 100%;");
        input1.setAttribute("type", "hidden");

        var p1 = document.createElement("p");
        p1.setAttribute("id", count + "NameB");

        col1.append(label1);
        col1.append(input1);
        col1.append(p1);

        var col2 = document.createElement("div");
        col2.setAttribute("class", "col-6");

        var label2 = document.createElement("label");
        label2.innerHTML = "Party:";

        var input2 = document.createElement("input");
        input2.setAttribute("id", count + "Party");
        input2.setAttribute("name", "party[]");
        input2.setAttribute("style", "width: 100%;");
        input2.setAttribute("type", "hidden");

        var p2 = document.createElement("p");
        p2.setAttribute("id", count + "PartyB");

        col2.append(label2);
        col2.append(input2);
        col2.append(p2);
        row1.append(col1);
        row1.append(col2);

        var row2 = document.createElement("div");
        row2.setAttribute("class", "row");

        var col3 = document.createElement("div");
        col3.setAttribute("class", "col-12");

        var label3 = document.createElement("label");
        label3.innerHTML = "Description:";

        var input3 = document.createElement("input");
        input3.setAttribute("id", count + "Des");
        input3.setAttribute("name", "description[]");
        input3.setAttribute("type", "hidden");

        var p3 = document.createElement("p");
        p3.setAttribute("id", count + "DesB");
        p3.setAttribute("style", "min-height: 8em;")

        col3.append(label3);
        col3.append(input3);
        col3.append(p3);
        row2.append(col3);

        var newP = document.createElement("a");
        newP.setAttribute("href", "javascript:{}");
        newP.setAttribute("onclick", "picker('" + count + "');");
        newP.innerHTML = "Pick new Politician";

        var removeP = document.createElement("a");
        removeP.setAttribute("href", "javascript:{}");
        removeP.setAttribute("onclick", "remove('" + count + "Div');");
        removeP.innerHTML = "Remove Politician";

        container.append(row1);
        container.append(row2);
        container.append(newP);
        container.append(removeP);

        con.append(container);
    }
</script>


<div id="confermation" style="visibility: hidden;" class="conCenter">
    @foreach (var item in ViewBag.pol)
    {

        <div class="container" href="javascript:{}" onclick="RemoveCon('@item.Name', '@item.PoliticalParty','@item.Description')" style="margin: 1em;">
            <div class="row" style="border: 0.15em solid black; min-height: 17em;">
                @if (item.ImageUrl == null)
                {
                    <div class="col-3 imageContainer">
                        <img class="vertical-center" src="~/images/defaultUser.png" alt="@item.Name" title="@item.Name" style="width: 15em; height: 15em;" />
                    </div>
                }
                else
                {
                    <div class="col-3 imageContainer">
                        <img class="vertical-center" src="@item.ImageUrl" alt="@item.Name" title="@item.Name" style="width: 15em; height: 15em;" />
                    </div>
                }
                <div class="col-7">
                    <h4>@item.Name</h4>
                    <h5>Party: @item.PoliticalParty</h5>
                    <p>@item.Description</p>
                </div>
            </div>
        </div>
    }
</div>

<script>
    function buildRunners() {
        var runners = "";
        var names = document.getElementsByName("name[]");
        var partys = document.getElementsByName("party[]");
        var descriptions = document.getElementsByName("description[]");

        for (var i = 0; i < names.length; i++) {
            if (descriptions[i].value == "") {
                runners += names[i].value + "~" + partys[i].value + "~NoDesc;";
            } else {
                runners += names[i].value + "~" + partys[i].value + "~" + descriptions[i].value + ";";
            }
        }
        document.getElementById("runners").value = runners;
        document.getElementById("save").value = "Save";
        //alert(runners);
        document.getElementById('update').submit();
    }

    function cancel() {
        document.getElementById("save").value = "No";
        document.getElementById('update').submit();
    }
</script>

@for (int i = 0; i < data.Length; i++)
{
    var runners = data[i].Runners.ToArray();

    <div class="container" style="margin-bottom: 1em;">
        <form method="post" id="update">
            <input id="runners" name="runners" value="" hidden/>
            <input id="save" name="save" hidden/>
            <input name="race" value="@data[i].Race" style="width: 100%;" hidden />
            <input name="state" value="@data[i].State" style="width: 100%;" hidden />
            <input name="city" value="@data[i].City" style="width: 100%;" hidden />
            <div class="row">
                <div class="col-4"><label for="race">Race:</label><h4>@data[i].Race</h4></div>
                <div class="col-4"><label for="state">State:</label><h4>@data[i].State</h4></div>
                <div class="col-4"><label for="city">City:</label><h4>@data[i].City</h4></div>
            </div>
        </form>
        <form id="poli">
            @for (int x = 0; x < runners.Length; x++)
            {
                <div style="border: 0.15em solid black; padding: 1em; margin-top: 1em;" id="@(x+"Div")">
                    <div class="row" style="margin-bottom: 1em;">
                        <div class="col-6">
                            <label for="name">Name:</label>
                            <input id="@(x+"Name")" name="name[]" value="@runners[x].Name" style="width: 100%;" hidden />
                            <p id="@(x+"NameB")">@runners[x].Name</p>
                        </div>
                        <div class="col-6">
                            <label for="party">Party:</label>
                            <input id="@(x+"Party")" name="party[]" value="@runners[x].PoliticalParty" style="width: 100%;" hidden />
                            <p id="@(x+"PartyB")">@runners[x].PoliticalParty</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <label for="description">Description:</label>
                            <textarea id="@(x+"Des")" name="description[]" rows="8" style="width: 100%;" hidden>@runners[x].Description</textarea>
                            <p id="@(x+"DesB")" style="min-height: 8em;">@runners[x].Description</p>

                        </div>
                    </div>
                    <a href="javascript:{}" onclick="picker('@x');">Pick New Politician</a>
                    <a href="javascript:{}" onclick="remove('@(x+"Div")');">Remove Politician</a>
                </div>
            }

        </form>
    </div>
    <a href="javascript:{}" onclick="AddRunner();">Add Runner</a>
    <a href="javascript:{}" onclick="buildRunners();">Save</a>
    <a href="javascript:{}" onclick="cancel();">Cancel</a>
}
<div style="height: 3em;"></div>